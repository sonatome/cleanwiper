<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CleanSweep Pest Control</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Include EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc;
        }
        .text-shadow {
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        /* Style for the 16:9 iframe container */
        .pt-\[56\.25\%\] {
            padding-top: 56.25%; /* 16:9 aspect ratio */
        }
       
    </style>
</head>
<body class="bg-gray-50">

    <!-- Header & Navigation -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="text-2xl font-bold text-green-700">Micro Gen</a>
            <div class="flex items-center space-x-6">
                <a href="#services" class="text-gray-600 hover:text-green-700 font-medium">Services</a>
                <a href="#projects" class="text-gray-600 hover:text-green-700 font-medium">Projects</a>
                <a href="#blog" class="text-gray-600 hover:text-green-700 font-medium">Blog</a>
                <button id="cart-button" class="relative text-gray-600 hover:text-green-700 focus:outline-none">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.182 1.944.643 2.118l.643.16M11 20a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"></path>
                    </svg>
                    <span id="cart-count" class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full">0</span>
                </button>
            </div>
        </nav>
    </header>

    <!-- Hero Section -->
    <section class="bg-cover bg-center h-[500px] flex items-center justify-center text-center text-white p-6 rounded-b-3xl shadow-lg" style="background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://placehold.co/1920x500/0b5345/ffffff?text=Your+Hero+In+Pest+Control');">
        <div class="space-y-4">
            <h1 class="space text-4xl md:text-6xl font-extrabold tracking-tight text-shadow">Your Home, Pest-Free.</h1>
            <p class="text-lg md:text-xl font-medium max-w-2xl mx-auto text-shadow">Comprehensive and eco-friendly pest control solutions for your peace of mind.</p>
            <a href="#services" class="inline-block px-8 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-full shadow-lg transition duration-300 transform hover:scale-105">
                Explore Our Services
            </a>
        </div>
    </section>


   

    
    <!-- Services Section -->
    <section id="services" class="py-20">
        <div class="container mx-auto px-6">
            <h2 class="text-4xl font-bold text-center text-gray-800 mb-4">Our Services</h2>
            <p class="text-xl text-center text-gray-600 mb-12 max-w-2xl mx-auto">We offer a range of specialized services to tackle any pest problem, big or small.</p>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">

                <!-- Service Card 1: Termites -->
                <div class="bg-white rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300 p-8 flex flex-col items-center text-center service-card">
                    <img src="https://placehold.co/120x120/4e342e/ffffff?text=Termite" alt="Termite icon" class="w-24 h-24 mb-6 rounded-full border-4 border-amber-500">
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">Anti-Termites Treatment</h3>
                    <p class="text-gray-600 mb-4">Protect your home's foundation with our advanced termite detection and elimination methods.</p>
                    <span class="text-xl font-bold text-green-700 mb-4">P10,000.00</span>
                    <button class="add-to-cart px-6 py-2 bg-green-600 text-white rounded-full font-semibold hover:bg-green-700 transition-colors" data-name="Termite Treatment" data-price="150.00">Add to Cart</button>
                </div>

                <!-- Service Card 2: Rodents -->
                <div class="bg-white rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300 p-8 flex flex-col items-center text-center service-card">
                    <img src="https://placehold.co/120x120/757575/ffffff?text=Termites" alt="Ant icon" class="w-24 h-24 mb-6 rounded-full border-4 border-gray-500">
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">Soil Poisoning</h3>
                    <p class="text-gray-600 mb-4">Safe and humane rodent control to keep your property free from unwanted guests.</p>
                    <span class="text-xl font-bold text-green-700 mb-4">P12,000.00</span>
                    <button class="add-to-cart px-6 py-2 bg-green-600 text-white rounded-full font-semibold hover:bg-green-700 transition-colors" data-name="Rodent Extermination" data-price="120.00">Add to Cart</button>
                </div>

                <!-- Service Card 3: Ants -->
                <div class="bg-white rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300 p-8 flex flex-col items-center text-center service-card">
                    <img src="https://placehold.co/120x120/ffcc00/ffffff?text=Insects" alt="Rodent icon" class="w-24 h-24 mb-6 rounded-full border-4 border-yellow-500">
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">General Pest Control</h3>
                    <p class="text-gray-600 mb-4">Effective and lasting solutions to eliminate common household insects from your home.</p>
                    <span class="text-xl font-bold text-green-700 mb-4">P15,000.00</span>
                    <button class="add-to-cart px-6 py-2 bg-green-600 text-white rounded-full font-semibold hover:bg-green-700 transition-colors" data-name="Ant & Roach Control" data-price="90.00">Add to Cart</button>
                </div>

            </div>
        </div>
    </section>

    <!-- Previous Projects Section (New Carousel) -->
    <section id="projects" class="py-20 bg-white">
        <div class="container mx-auto px-6">
            <h2 class="text-4xl font-bold text-center text-gray-800 mb-4">Our Success Stories</h2>
            <p class="text-xl text-center text-gray-600 mb-12 max-w-3xl mx-auto">See how CleanSweep has helped our customers achieve a pest-free environment with guaranteed results.</p>

            <div class="relative">
                <div id="projects-carousel-container" class="overflow-hidden rounded-xl shadow-xl border border-gray-200">
                    <div id="projects-carousel" class="flex transition-transform duration-500 ease-in-out">
                        
                        <!-- Project Card 1: Rodent Clearance -->
                        <div class="w-full flex-shrink-0 p-4 lg:p-8">
                            <div class="bg-white rounded-xl overflow-hidden w-full">
                                <div class="lg:flex lg:items-start space-y-6 lg:space-y-0 lg:space-x-8">
                                    <img src="https://placehold.co/500x350/e0e7ff/3f3f46?text=Rodent+Clearance" alt="Rodent clearance project" class="w-full lg:w-1/2 h-64 lg:h-80 object-cover rounded-lg shadow-md">
                                    <div class="lg:w-1/2">
                                        <h3 class="text-3xl font-bold text-green-700 mb-3">Residential Rodent Clearance</h3>
                                        <span class="inline-block bg-yellow-100 text-yellow-800 text-xs font-medium px-3 py-1 rounded-full mb-4">Completed: August 2024</span>
                                        <p class="text-gray-700 mb-4 text-lg">
                                            **Challenge:** A family home was experiencing heavy rat activity in the attic and crawlspace, posing health risks and damaging insulation.
                                        </p>
                                        <p class="text-gray-600">
                                            **Solution:** We implemented a two-stage approach: immediate population control followed by extensive exclusion work. We sealed 15 external entry points using mesh and sealant, and installed tamper-proof bait stations.
                                        </p>
                                        <p class="text-gray-600 mt-2 font-semibold">
                                            **Result:** 100% eradication within two weeks, with a guaranteed pest-free period. The family now enjoys peace of mind.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Project Card 2: Commercial Ant Control -->
                        <div class="w-full flex-shrink-0 p-4 lg:p-8">
                            <div class="bg-white rounded-xl overflow-hidden w-full">
                                <div class="lg:flex lg:items-start space-y-6 lg:space-y-0 lg:space-x-8">
                                    <img src="https://placehold.co/500x350/f0f9ff/006064?text=Commercial+Ants" alt="Commercial kitchen ant control" class="w-full lg:w-1/2 h-64 lg:h-80 object-cover rounded-lg shadow-md">
                                    <div class="lg:w-1/2">
                                        <h3 class="text-3xl font-bold text-green-700 mb-3">Commercial Kitchen Ant Control</h3>
                                        <span class="inline-block bg-blue-100 text-blue-800 text-xs font-medium px-3 py-1 rounded-full mb-4">Completed: July 2024</span>
                                        <p class="text-gray-700 mb-4 text-lg">
                                            **Challenge:** A busy downtown restaurant was facing a persistent ant problem (Pharaoh ants) that threatened health inspections and operations.
                                        </p>
                                        <p class="text-gray-600">
                                            **Solution:** We used non-toxic, targeted baiting systems that the colony carried back to the nest. We provided staff training on sanitation best practices and quarterly follow-up treatments.
                                        </p>
                                        <p class="text-gray-600 mt-2 font-semibold">
                                            **Result:** Complete colony elimination. The restaurant passed its subsequent health inspection with flying colors and zero ant sightings.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Project Card 3: Historical Building Termite Protection -->
                        <div class="w-full flex-shrink-0 p-4 lg:p-8">
                            <div class="bg-white rounded-xl overflow-hidden w-full">
                                <div class="lg:flex lg:items-start space-y-6 lg:space-y-0 lg:space-x-8">
                                    <img src="https://placehold.co/500x350/ffe6e6/6a0000?text=Termite+Barrier" alt="Historical building termite protection" class="w-full lg:w-1/2 h-64 lg:h-80 object-cover rounded-lg shadow-md">
                                    <div class="lg:w-1/2">
                                        <h3 class="text-3xl font-bold text-green-700 mb-3">Historical Termite Protection</h3>
                                        <span class="inline-block bg-red-100 text-red-800 text-xs font-medium px-3 py-1 rounded-full mb-4">Completed: June 2024</span>
                                        <p class="text-gray-700 mb-4 text-lg">
                                            **Challenge:** A 100-year-old museum was vulnerable to subterranean termite damage, requiring a non-invasive protection method.
                                        </p>
                                        <p class="text-gray-600">
                                            **Solution:** We installed a perimeter monitoring and baiting system, avoiding drilling into the historic foundation. This provides continuous protection and immediate detection of new activity.
                                        </p>
                                        <p class="text-gray-600 mt-2 font-semibold">
                                            **Result:** The museum is now protected without compromising the integrity of the historical structure. Ongoing monitoring ensures long-term safety.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <button id="prev-project-btn" class="absolute top-1/2 -left-2 transform -translate-y-1/2 bg-green-600 text-white p-3 rounded-full shadow-xl hover:bg-green-700 transition-colors z-10 hidden md:block">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                </button>
                <button id="next-project-btn" class="absolute top-1/2 -right-2 transform -translate-y-1/2 bg-green-600 text-white p-3 rounded-full shadow-xl hover:bg-green-700 transition-colors z-10 hidden md:block">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                </button>
            </div>
            <!-- Indicator Dots (Visible on mobile and desktop) -->
            <div id="carousel-indicators" class="flex justify-center mt-6 space-x-2">
                <!-- Dots will be added here by JS -->
            </div>
        </div>
    </section>

    <!-- Blog Section -->
    <section id="blog" class="py-20 bg-gray-100">
        <div class="container mx-auto px-6">
            <h2 class="text-4xl font-bold text-center text-gray-800 mb-4">Our Latest Blog Posts</h2>
            <p class="text-xl text-center text-gray-600 mb-12 max-w-2xl mx-auto">Stay informed with expert tips and insights on pest prevention and control.</p>

            <!-- New Post Button -->
            <div class="flex justify-center mb-10">
                <button id="new-post-button" class="px-6 py-3 bg-indigo-600 text-white font-semibold rounded-full hover:bg-indigo-700 transition-colors shadow-lg flex items-center space-x-2">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M11 9h4v2h-4v4h-2v-4H5V9h4V5h2v4z"></path></svg>
                    <span>Create New Post</span>
                </button>
            </div>

            <div id="blog-posts-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Blog posts will be dynamically loaded here by JavaScript -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-12">
        <div class="container mx-auto px-6 text-center">
            <div class="mb-4">
                <p>&copy; 2024 CleanSweep Pest Control. All rights reserved.</p>
            </div>
            <div class="flex justify-center space-x-6">
                <a href="./cleanwiper/multiPage.html#privacy" class="hover:text-green-500 transition-colors">Privacy Policy</a>
                <a href="./cleanwiper/multiPage.html#terms" class="hover:text-green-500 transition-colors">Terms of Service</a>
                <a href="./cleanwiper/multiPage.html#contact" class="hover:text-green-500 transition-colors">Contact Us</a>
            </div>
        </div>
    </footer>

    <!-- Cart Modal -->
    <div id="cart-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-lg relative">
            <button id="close-modal-button" class="absolute top-4 right-4 text-gray-600 hover:text-gray-800 transition-colors">
                <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <h3 class="text-3xl font-bold text-gray-800 mb-4">Your Cart</h3>
            <div id="cart-content">
                <ul id="cart-items-list" class="space-y-4 max-h-80 overflow-y-auto pr-2">
                    <!-- Cart items will be injected here -->
                </ul>
                <div id="cart-empty-message" class="text-gray-500 text-center py-8 hidden">
                    Your cart is empty. Add a service to get started!
                </div>
                <!-- Customer Name Input Field (The element you were looking for) -->
                <div class="mt-4">
                    <label for="name-input" class="block text-sm font-medium text-gray-700">Your Full Name</label>
                    <input type="text" id="name-input" placeholder="Enter your name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm p-2">
                    <div id="name-error" class="text-sm text-red-500 mt-2 hidden"></div>
                </div>
                <!-- Email Input Field -->
                <div class="mt-4">
                    <label for="email-input" class="block text-sm font-medium text-gray-700">Email Address</label>
                    <input type="email" id="email-input" placeholder="Enter your email for confirmation" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm p-2">
                    <div id="email-error" class="text-sm text-red-500 mt-2 hidden"></div>
                </div>
                <div class="flex justify-between items-center border-t border-gray-200 mt-6 pt-4">
                    <span class="text-xl font-semibold text-gray-800">Total:</span>
                    <span id="cart-total" class="text-2xl font-bold text-green-700">$0.00</span>
                </div>
                <button id="checkout-button" class="mt-6 w-full px-6 py-3 bg-green-600 text-white font-semibold rounded-full hover:bg-green-700 transition-colors">
                    Checkout
                </button>
            </div>
            <div id="checkout-success-message" class="hidden text-center py-12">
                <!-- Order ID will be injected here -->
                <svg class="w-20 h-20 text-green-500 mx-auto mb-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                <h3 class="text-3xl font-bold text-gray-800 mb-2">Thank You!</h3>
                <p class="text-gray-600">Your order has been successfully placed. We'll be in touch shortly.</p>
            </div>
            <div id="checkout-error-message" class="hidden text-center py-12 text-red-600">
                <svg class="w-20 h-20 mx-auto mb-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                </svg>
                <h3 class="text-3xl font-bold mb-2">Something went wrong!</h3>
                <p class="text-gray-600">We could not process your request. Please try again later.</p>
            </div>
        </div>
    </div>
    
    <!-- Post Creation Modal -->
    <div id="post-creation-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-2xl relative">
            <button id="close-post-modal-button" class="absolute top-4 right-4 text-gray-600 hover:text-gray-800 transition-colors">
                <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <h3 class="text-3xl font-bold text-gray-800 mb-6">Create New Blog Post</h3>

            <form id="post-form" class="space-y-4">
                <div>
                    <label for="post-title" class="block text-sm font-medium text-gray-700">Post Title</label>
                    <input type="text" id="post-title" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">
                </div>

                <div>
                    <label for="post-content" class="block text-sm font-medium text-gray-700">Content</label>
                    <textarea id="post-content" rows="4" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2"></textarea>
                </div>

                <!-- Video Upload Options -->
                <div class="border-t pt-4 space-y-4">
                    <h4 class="text-lg font-semibold text-gray-800">Add Media (Optional)</h4>

                    <!-- File/Blob Upload -->
                    <div>
                        <label for="video-file-input" class="block text-sm font-medium text-gray-700">Upload Video File (.mp4, .mov, etc.)</label>
                        <input type="file" id="video-file-input" accept="video/*" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
                        <p class="text-xs text-gray-500 mt-1">Uses a local Blob URL for display. Will override YouTube link if both are present.</p>
                    </div>

                    <!-- YouTube URL Input -->
                    <div class="flex items-center space-x-2">
                        <div class="flex-1">
                            <label for="youtube-url-input" class="block text-sm font-medium text-gray-700">OR Embed YouTube Link</label>
                            <input type="url" id="youtube-url-input" placeholder="e.g., https://www.youtube.com/watch?v=dQw4w9WgXcQ" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">
                        </div>
                        <button type="button" id="clear-video-button" class="mt-5 p-2 rounded-md bg-red-500 text-white hover:bg-red-600 transition-colors self-end">
                            Clear Media
                        </button>
                    </div>
                </div>

                <button type="submit" id="submit-post-button" class="w-full px-6 py-3 bg-green-600 text-white font-semibold rounded-full hover:bg-green-700 transition-colors shadow-lg">
                    Publish Post
                </button>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const cartButton = document.getElementById('cart-button');
            const cartModal = document.getElementById('cart-modal');
            const closeModalButton = document.getElementById('close-modal-button');
            const cartItemsList = document.getElementById('cart-items-list');
            const cartTotal = document.getElementById('cart-total');
            const cartCount = document.getElementById('cart-count');
            const cartEmptyMessage = document.getElementById('cart-empty-message');
            const addToCartButtons = document.querySelectorAll('.add-to-cart');
            const checkoutButton = document.getElementById('checkout-button');
            const cartContent = document.getElementById('cart-content');
            const checkoutSuccessMessage = document.getElementById('checkout-success-message');
            const checkoutErrorMessage = document.getElementById('checkout-error-message');
            const emailInput = document.getElementById('email-input');
            const emailError = document.getElementById('email-error');
            const nameInput = document.getElementById('name-input');
            const nameError = document.getElementById('name-error');

            // New Post functionality variables
            const newPostButton = document.getElementById('new-post-button');
            const postModal = document.getElementById('post-creation-modal');
            const closePostModalButton = document.getElementById('close-post-modal-button');
            const postForm = document.getElementById('post-form');
            const postTitleInput = document.getElementById('post-title');
            const postContentInput = document.getElementById('post-content');
            const videoFileInput = document.getElementById('video-file-input');
            const youtubeUrlInput = document.getElementById('youtube-url-input');
            const clearVideoButton = document.getElementById('clear-video-button');
            const blogPostsContainer = document.getElementById('blog-posts-container');

            // Project Carousel Variables (NEW)
            const carousel = document.getElementById('projects-carousel');
            const prevBtn = document.getElementById('prev-project-btn');
            const nextBtn = document.getElementById('next-project-btn');
            const indicatorsContainer = document.getElementById('carousel-indicators');
            const totalSlides = 3;
            let currentSlide = 0;


            // Initial load from localStorage
            let cart = JSON.parse(localStorage.getItem('cart')) || [];

            // Static blog posts (UPDATED with file links)
            const staticPosts = [
                { title: "DIY Pest Prevention Tips", content: "Learn simple steps you can take to keep common pests out of your home year-round.", image: "https://placehold.co/600x400/5e8e7a/ffffff?text=DIY+Tips", link: "diy.html" },
                { title: "The Ultimate Termite Guide", content: "Everything you need to know about termites, from early signs to professional treatment.", image: "https://placehold.co/600x400/805ad5/ffffff?text=Termite+Guide", link: "termiteGuide.html" },
                { title: "Signs of a Rodent Infestation", content: "Knowing the warning signs can save you from a major rodent problem down the line.", image: "https://placehold.co/600x400/f6ad55/ffffff?text=Rodent+Signs", link: "rodentSign.html" },
            ];

            // --- Utility Functions ---

            // Function to generate a unique ID
            const generateOrderId = () => {
                const prefix = 'CS-'; // CleanSweep Prefix
                const randomPart = Math.random().toString(36).substring(2, 8).toUpperCase(); // 6 random characters
                const timestampPart = Date.now().toString().substring(8); // last 5 digits of timestamp
                return `${prefix}${timestampPart}${randomPart}`;
            };
            
            // Function to safely get YouTube embed URL
            const getYoutubeEmbedUrl = (url) => {
                if (!url) return null;
                // Regex to extract video ID from various YouTube URL formats
                const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
                const match = url.match(regExp);
                
                if (match && match[2].length === 11) {
                    return `https://www.youtube.com/embed/${match[2]}`;
                }
                return null;
            };

            // --- Cart Logic ---

            const updateCartUI = () => {
                cartItemsList.innerHTML = '';
                let total = 0;

                if (cart.length === 0) {
                    cartEmptyMessage.classList.remove('hidden');
                } else {
                    cartEmptyMessage.classList.add('hidden');
                    cart.forEach((item, index) => {
                        const li = document.createElement('li');
                        li.className = 'flex justify-between items-center bg-gray-100 p-4 rounded-lg shadow-sm';
                        li.innerHTML = `
                            <div class="flex-1">
                                <h4 class="text-lg font-semibold text-gray-800">${item.name}</h4>
                            </div>
                            <div class="flex items-center space-x-4">
                                <span class="text-lg font-bold text-green-700">$${item.price.toFixed(2)}</span>
                                <button data-index="${index}" class="remove-from-cart text-red-500 hover:text-red-700 transition-colors">
                                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                </button>
                            </div>
                        `;
                        cartItemsList.appendChild(li);
                        total += item.price;
                    });
                }

                cartTotal.textContent = `$${total.toFixed(2)}`;
                cartCount.textContent = cart.length;
            };

            const saveCart = () => {
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartUI();
            };

            addToCartButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const name = e.target.getAttribute('data-name');
                    const price = parseFloat(e.target.getAttribute('data-price'));
                    cart.push({ name, price });
                    saveCart();

                    // Dynamic button feedback
                    const originalText = button.textContent;
                    button.textContent = "Added!";
                    button.disabled = true;
                    button.classList.remove('bg-green-600', 'hover:bg-green-700');
                    button.classList.add('bg-green-400', 'hover:bg-green-400');
                    setTimeout(() => {
                        button.textContent = originalText;
                        button.disabled = false;
                        button.classList.remove('bg-green-400', 'hover:bg-green-400');
                        button.classList.add('bg-green-600', 'hover:bg-green-700');
                    }, 2000); // Revert after 2 seconds
                });
            });

            cartItemsList.addEventListener('click', (e) => {
                if (e.target.closest('.remove-from-cart')) {
                    const index = e.target.closest('.remove-from-cart').getAttribute('data-index');
                    cart.splice(index, 1);
                    saveCart();
                }
            });

            // Function to format cart items for the email
            const formatCartItems = (cart) => {
                if (cart.length === 0) {
                    return "No items in cart.";
                }
                // Use a simple formatted list for the email body
                return cart.map(item => `- ${item.name} ($${item.price.toFixed(2)})`).join('\n');
            };

            // Initialize EmailJS with your public key
            // *** IMPORTANT: REPLACE WITH YOUR ACTUAL KEY ***
            emailjs.init({
                publicKey: 'a6xclp_ZjBZwev9BH', 
            });

            checkoutButton.addEventListener('click', () => {
                const userEmail = emailInput.value;
                const userName = nameInput.value;
                let isValid = true;

                // Simple validation check for Name
                if (!userName.trim()) {
                    nameError.textContent = 'Please enter your full name.';
                    nameError.classList.remove('hidden');
                    isValid = false;
                } else {
                    nameError.classList.add('hidden');
                }

                // Simple validation check for Email
                if (!userEmail || !userEmail.includes('@') || !userEmail.includes('.')) {
                    emailError.textContent = 'Please enter a valid email address.';
                    emailError.classList.remove('hidden');
                    isValid = false;
                } else {
                    emailError.classList.add('hidden');
                }

                if (!isValid) return;


                const orderId = generateOrderId(); // Generate the unique order ID

                // Prepare the email template parameters
                const templateParams = {
                    from_name: userName,
                    user_email: userEmail,
                    order_id: orderId, // New order ID variable
                    cart_items: formatCartItems(cart),
                    total_price: cart.reduce((sum, item) => sum + item.price, 0).toFixed(2)
                };
                
                // Change button state to indicate action
                const originalText = checkoutButton.textContent;
                checkoutButton.textContent = 'Sending...';
                checkoutButton.disabled = true;

                // Send the email using EmailJS
                // *** IMPORTANT: REPLACE WITH YOUR ACTUAL SERVICE AND TEMPLATE IDs ***
                emailjs.send('service_16jxyry', 'template_c5as6b6', templateParams)
                    .then((response) => {
                       console.log('SUCCESS!', response.status, response.text);

                       // Update the success message with the order ID and personalized email
                       document.querySelector('#checkout-success-message p').textContent = `Your order (ID: ${orderId}) has been successfully placed. A confirmation has been sent to ${userEmail}.`;

                       // Hide cart content and show success message
                       cartContent.classList.add('hidden');
                       checkoutSuccessMessage.classList.remove('hidden');

                       // Clear the cart and reset inputs
                       cart = [];
                       saveCart();
                       emailInput.value = '';
                       nameInput.value = '';
                       
                       // Close modal and reset UI after a delay
                       setTimeout(() => {
                            cartModal.classList.add('hidden');
                            cartContent.classList.remove('hidden');
                            checkoutSuccessMessage.classList.add('hidden');
                            // Reset button text and state
                            checkoutButton.textContent = originalText;
                            checkoutButton.disabled = false;
                       }, 4000);
                    }, (error) => {
                        console.error('FAILED...', error);
                        // Provide a fallback error message if no specific message is available
                        const errorMessage = error.text || error.status || 'An unknown error occurred. Please check your EmailJS IDs.';
                        document.querySelector('#checkout-error-message p').textContent = `Failed to send email. Please try again later. Error: ${errorMessage}`;

                        // Hide cart content and show error message
                        cartContent.classList.add('hidden');
                        checkoutErrorMessage.classList.remove('hidden');
                        
                        // Close modal and reset UI after a delay
                        setTimeout(() => {
                            cartModal.classList.add('hidden');
                            cartContent.classList.remove('hidden');
                            checkoutErrorMessage.classList.add('hidden');
                            // Reset button text and state
                            checkoutButton.textContent = originalText;
                            checkoutButton.disabled = false;
                        }, 4000);
                    });
            });

            cartButton.addEventListener('click', () => {
                updateCartUI();
                // Clear any previous error messages when opening the modal
                nameError.classList.add('hidden');
                emailError.classList.add('hidden');
                cartModal.classList.remove('hidden');
            });

            closeModalButton.addEventListener('click', () => {
                cartModal.classList.add('hidden');
            });

            // Close modal when clicking outside
            cartModal.addEventListener('click', (e) => {
                if (e.target === cartModal) {
                    cartModal.classList.add('hidden');
                }
            });

            updateCartUI(); // Initial UI update


            // --- Blog Post Management ---
            
            // Function to render all blog posts
            const loadBlogPosts = () => {
                blogPostsContainer.innerHTML = '';
                let dynamicPosts = JSON.parse(localStorage.getItem('dynamicPosts')) || [];

                // Combine static and dynamic posts for display (dynamic first to show newest)
                const allPosts = [...dynamicPosts, ...staticPosts];

                allPosts.forEach(post => {
                    const article = document.createElement('article');
                    article.className = 'bg-white rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300 overflow-hidden';
                    
                    let mediaHTML = '';
                    if (post.videoBlobUrl) {
                        // Display uploaded video using blob URL
                        mediaHTML = `<video class="w-full h-48 object-cover" controls><source src="${post.videoBlobUrl}" type="video/mp4"></video>`;
                    } else if (post.youtubeEmbedUrl) {
                        // Display YouTube video using iframe embed
                        mediaHTML = `
                            <div class="relative pt-[56.25%]"> <!-- 16:9 Aspect Ratio -->
                                <iframe class="absolute top-0 left-0 w-full h-full" src="${post.youtubeEmbedUrl}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            </div>
                        `;
                    } else if (post.image) {
                        // Display static image fallback
                         mediaHTML = `<img src="${post.image}" alt="Blog post image" class="w-full h-48 object-cover">`;
                    } else {
                        // Placeholder for new posts without media
                        mediaHTML = `<div class="w-full h-48 bg-gray-200 flex items-center justify-center text-gray-500">No Media Attached</div>`;
                    }


                    article.innerHTML = `
                        ${mediaHTML}
                        <div class="p-6">
                            <h3 class="text-2xl font-bold text-gray-800 mb-2">${post.title}</h3>
                            <p class="text-gray-600 mb-4">${post.content}</p>
                            <a href="${post.link || '#'}" class="text-green-600 font-semibold hover:underline">Read more &rarr;</a>
                            ${post.isDynamic ? `<button data-id="${post.id}" class="delete-post-button mt-2 text-sm text-red-500 hover:text-red-700">Delete Post</button>` : ''}
                        </div>
                    `;

                    blogPostsContainer.appendChild(article);
                });

                // Add listener for dynamic delete buttons
                document.querySelectorAll('.delete-post-button').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const postId = e.target.getAttribute('data-id');
                        deletePost(postId);
                    });
                });
            };
            
            // Function to delete a dynamic post
            const deletePost = (postId) => {
                let dynamicPosts = JSON.parse(localStorage.getItem('dynamicPosts')) || [];
                // Find post to revoke Blob URL if it exists
                const postToDelete = dynamicPosts.find(post => post.id === postId);
                if (postToDelete && postToDelete.videoBlobUrl) {
                    URL.revokeObjectURL(postToDelete.videoBlobUrl);
                }

                dynamicPosts = dynamicPosts.filter(post => post.id !== postId);
                localStorage.setItem('dynamicPosts', JSON.stringify(dynamicPosts));
                loadBlogPosts(); // Reload posts
            };

            // Post Form Submission Handler
            postForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const title = postTitleInput.value;
                const content = postContentInput.value;
                const youtubeUrl = youtubeUrlInput.value.trim();
                const videoFile = videoFileInput.files[0];

                let videoBlobUrl = null;
                let youtubeEmbedUrl = getYoutubeEmbedUrl(youtubeUrl);
                
                // 1. Handle File Upload (Blob URL)
                if (videoFile) {
                    // Create a blob URL for the uploaded video file
                    videoBlobUrl = URL.createObjectURL(videoFile);
                    youtubeEmbedUrl = null; // Prioritize local upload over YouTube link
                }
                
                // 2. Handle YouTube URL (if no file was uploaded)
                if (!videoFile && youtubeUrl) {
                    // youtubeEmbedUrl is already set by getYoutubeEmbedUrl
                    if (!youtubeEmbedUrl) {
                        // Using a simple message box since alert() is prohibited
                        document.querySelector('#youtube-url-input').focus();
                        console.error('Invalid YouTube URL');
                        return; // Stop submission if YouTube URL is invalid
                    }
                }
                
                // 3. Create the new post object
                const newPost = {
                    id: Date.now().toString(), // Simple unique ID
                    title: title,
                    content: content,
                    image: null, // Dynamic posts don't use the static image
                    link: '#',
                    isDynamic: true,
                    videoBlobUrl: videoBlobUrl,
                    youtubeEmbedUrl: youtubeEmbedUrl
                };

                // 4. Save to localStorage
                let dynamicPosts = JSON.parse(localStorage.getItem('dynamicPosts')) || [];
                dynamicPosts.unshift(newPost); // Add to the beginning (newest first)
                localStorage.setItem('dynamicPosts', JSON.stringify(dynamicPosts));

                // 5. Reset form and close modal
                postForm.reset();
                postModal.classList.add('hidden');
                
                // 6. Refresh blog display
                loadBlogPosts();
            });
            
            // Clear Video Button Logic
            clearVideoButton.addEventListener('click', () => {
                videoFileInput.value = '';
                youtubeUrlInput.value = '';
            });

            // Post Modal Controls
            newPostButton.addEventListener('click', () => {
                // Clear the form and reset the state when opening
                postForm.reset();
                postModal.classList.remove('hidden');
            });

            closePostModalButton.addEventListener('click', () => {
                postModal.classList.add('hidden');
            });

            // Close modal when clicking outside
            postModal.addEventListener('click', (e) => {
                if (e.target === postModal) {
                    postModal.classList.add('hidden');
                }
            });

            // Initial load of blog posts
            loadBlogPosts();

            // --- Project Carousel Logic (NEW) ---
            
            // Function to update the carousel position
            const updateCarousel = () => {
                // Calculate the offset based on the current slide index
                const offset = -currentSlide * 100;
                carousel.style.transform = `translateX(${offset}%)`;
                updateIndicators();
            };

            // Function to handle next slide
            const nextSlide = () => {
                currentSlide = (currentSlide + 1) % totalSlides;
                updateCarousel();
            };

            // Function to handle previous slide
            const prevSlide = () => {
                // Modulo math to handle wrap-around for negative index
                currentSlide = (currentSlide - 1 + totalSlides) % totalSlides; 
                updateCarousel();
            };

            // Function to create and update indicators
            const updateIndicators = () => {
                indicatorsContainer.innerHTML = '';
                for (let i = 0; i < totalSlides; i++) {
                    const dot = document.createElement('div');
                    dot.className = `w-3 h-3 rounded-full cursor-pointer transition-colors duration-300 ${i === currentSlide ? 'bg-green-600' : 'bg-gray-300 hover:bg-gray-400'}`;
                    dot.addEventListener('click', () => {
                        currentSlide = i;
                        updateCarousel();
                    });
                    indicatorsContainer.appendChild(dot);
                }
            };

            // Attach listeners
            nextBtn.addEventListener('click', nextSlide);
            prevBtn.addEventListener('click', prevSlide);

            // Initialize indicators and carousel view
            updateIndicators();
            updateCarousel();
            // --- End Project Carousel Logic ---

        });
    </script>
</body>

</html>




